@using RHView_TCC.Models

@model RHView_TCC.Models.DailyWorkLog
@{
    ViewData["Title"] = "Detalhes do Usuário";
    var userId = ViewBag.UserId;
    var datas = ViewBag.Datas as List<DateTime>;
    var dataSelecionada = ViewBag.DataSelecionada as DateTime?;

    var processos = ViewBag.Processos as List<ProcessLog>;
    var inatividade = ViewBag.Inatividade as InactivityLog;
}

<h2>Detalhes do dia: @dataSelecionada?.ToString("dd/MM/yyyy")</h2>

<form method="get" asp-controller="User" asp-action="Detalhes">
    <input type="hidden" name="id" value="@userId" />
    <select name="dataSelecionada" class="form-select">
        @foreach (var data in datas) {
            <option value="@data.ToString("yyyy-MM-dd")" selected="@(data == dataSelecionada)">
                @data.ToString("dd/MM/yyyy")
            </option>
        }
    </select>
    <button type="submit" class="btn btn-primary mt-2">Ver Dados</button>
</form>

@if (Model != null) {
    <div class="mt-4">
        <h4>Tempo Trabalhado:</h4>
        <p>@Model.TimeWorked.ToString(@"hh\:mm\:ss")</p>
    </div>
} else {
    <p>Nenhum log encontrado para a data selecionada.</p>
}

@if (processos != null && processos.Any()) {
    <div class="mt-4">
        <h4>Processos Monitorados</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Aplicativo</th>
                    <th>Título da Janela</th>
                    <th>Tempo de Uso</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var p in processos) {
                    <tr>
                        <td>@p.AppName</td>
                        <td>@p.WindowTitle</td>
                        <td>@p.UsageTime.ToString(@"hh\:mm\:ss")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
} else {
    <p>Nenhum processo registrado nesse dia.</p>
}

@if (inatividade != null) {
    <div class="mt-4">
        <h4>Inatividade</h4>
        <ul>
            <li><strong>Tempo total de inatividade:</strong> @inatividade.TotalInactivity.ToString(@"hh\:mm\:ss")</li>
            <li><strong>Maior período contínuo:</strong> @inatividade.MaxInactivity.ToString(@"hh\:mm\:ss")</li>
        </ul>
    </div>
} else {
    <p>Nenhum log de inatividade registrado para essa data.</p>
}